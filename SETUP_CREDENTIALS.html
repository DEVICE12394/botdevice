<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Configuraci√≥n de Credenciales - Telegram Bot</title>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        min-height: 100vh;
        padding: 20px;
      }

      .container {
        max-width: 1200px;
        margin: 0 auto;
      }

      .header {
        text-align: center;
        color: white;
        margin-bottom: 40px;
      }

      .header h1 {
        font-size: 2.5em;
        margin-bottom: 10px;
        text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
      }

      .cards {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(500px, 1fr));
        gap: 30px;
        margin-bottom: 30px;
      }

      .card {
        background: white;
        border-radius: 15px;
        padding: 30px;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
      }

      .card-header {
        display: flex;
        align-items: center;
        margin-bottom: 20px;
      }

      .card-icon {
        font-size: 3em;
        margin-right: 15px;
      }

      .card-title {
        font-size: 1.8em;
        color: #333;
      }

      .step {
        background: #f8f9fa;
        padding: 15px;
        border-radius: 8px;
        margin-bottom: 15px;
        border-left: 4px solid #667eea;
      }

      .step-number {
        display: inline-block;
        background: #667eea;
        color: white;
        width: 30px;
        height: 30px;
        border-radius: 50%;
        text-align: center;
        line-height: 30px;
        margin-right: 10px;
        font-weight: bold;
      }

      .step-content {
        margin-left: 40px;
        margin-top: 10px;
      }

      .input-group {
        margin-top: 20px;
      }

      .input-group label {
        display: block;
        font-weight: bold;
        margin-bottom: 8px;
        color: #555;
      }

      .input-group input,
      .input-group textarea {
        width: 100%;
        padding: 12px;
        border: 2px solid #e0e0e0;
        border-radius: 8px;
        font-size: 14px;
        font-family: "Courier New", monospace;
        transition: border-color 0.3s;
      }

      .input-group input:focus,
      .input-group textarea:focus {
        outline: none;
        border-color: #667eea;
      }

      .input-group textarea {
        min-height: 100px;
        resize: vertical;
      }

      .btn {
        background: #667eea;
        color: white;
        border: none;
        padding: 12px 30px;
        border-radius: 8px;
        font-size: 16px;
        font-weight: bold;
        cursor: pointer;
        transition: all 0.3s;
        margin-top: 10px;
      }

      .btn:hover {
        background: #5568d3;
        transform: translateY(-2px);
        box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
      }

      .btn-success {
        background: #28a745;
      }

      .btn-success:hover {
        background: #218838;
      }

      .alert {
        padding: 15px;
        border-radius: 8px;
        margin-top: 15px;
        display: none;
      }

      .alert-success {
        background: #d4edda;
        color: #155724;
        border: 1px solid #c3e6cb;
      }

      .alert-danger {
        background: #f8d7da;
        color: #721c24;
        border: 1px solid #f5c6cb;
      }

      .alert-info {
        background: #d1ecf1;
        color: #0c5460;
        border: 1px solid #bee5eb;
      }

      .link-btn {
        display: inline-block;
        background: #007bff;
        color: white;
        padding: 10px 20px;
        border-radius: 6px;
        text-decoration: none;
        margin-top: 10px;
        transition: all 0.3s;
      }

      .link-btn:hover {
        background: #0056b3;
        transform: translateY(-2px);
      }

      .output-box {
        background: #2d2d2d;
        color: #00ff00;
        padding: 15px;
        border-radius: 8px;
        font-family: "Courier New", monospace;
        margin-top: 15px;
        display: none;
        white-space: pre-wrap;
        word-wrap: break-word;
      }

      .progress {
        margin-top: 30px;
        text-align: center;
      }

      .progress-bar {
        background: #e0e0e0;
        height: 30px;
        border-radius: 15px;
        overflow: hidden;
        margin-bottom: 15px;
      }

      .progress-fill {
        background: linear-gradient(90deg, #667eea, #764ba2);
        height: 100%;
        width: 0%;
        transition: width 0.5s;
        display: flex;
        align-items: center;
        justify-content: center;
        color: white;
        font-weight: bold;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <div class="header">
        <h1>ü§ñ Configuraci√≥n de Credenciales</h1>
        <p>Telegram Bot con Google Sheets</p>
      </div>

      <div class="progress">
        <div class="progress-bar">
          <div class="progress-fill" id="progressFill">0%</div>
        </div>
        <p style="color: white; font-size: 1.2em" id="progressText">
          Paso 1 de 3: Configurar Bot de Telegram
        </p>
      </div>

      <div class="cards">
        <!-- Card 1: Telegram Bot -->
        <div class="card">
          <div class="card-header">
            <div class="card-icon">üì±</div>
            <div class="card-title">1. Token de Telegram</div>
          </div>

          <div class="step">
            <span class="step-number">1</span>
            <strong>Abre Telegram</strong>
            <div class="step-content">En tu tel√©fono o computadora</div>
          </div>

          <div class="step">
            <span class="step-number">2</span>
            <strong>Busca @BotFather</strong>
            <div class="step-content">
              <a href="https://t.me/botfather" target="_blank" class="link-btn">
                Abrir @BotFather
              </a>
            </div>
          </div>

          <div class="step">
            <span class="step-number">3</span>
            <strong>Crea tu bot</strong>
            <div class="step-content">
              Env√≠a el comando: <code>/newbot</code><br />
              Sigue las instrucciones y copia el token
            </div>
          </div>

          <div class="input-group">
            <label for="telegramToken">Pega aqu√≠ tu Token de Telegram:</label>
            <input
              type="text"
              id="telegramToken"
              placeholder="123456789:ABCdefGHIjklMNOpqrsTUVwxyz..."
            />
            <button class="btn" onclick="validateTelegramToken()">
              Validar Token
            </button>
          </div>

          <div id="telegramAlert" class="alert"></div>
        </div>

        <!-- Card 2: Google Sheets -->
        <div class="card">
          <div class="card-header">
            <div class="card-icon">üìä</div>
            <div class="card-title">2. Google Sheets</div>
          </div>

          <div class="step">
            <span class="step-number">1</span>
            <strong>Google Cloud Console</strong>
            <div class="step-content">
              <a
                href="https://console.cloud.google.com/"
                target="_blank"
                class="link-btn"
              >
                Abrir Google Cloud
              </a>
            </div>
          </div>

          <div class="step">
            <span class="step-number">2</span>
            <strong>Crear Service Account</strong>
            <div class="step-content">
              Ve a: APIs & Services ‚Üí Credentials ‚Üí Create Credentials ‚Üí Service
              Account
            </div>
          </div>

          <div class="step">
            <span class="step-number">3</span>
            <strong>Descargar JSON</strong>
            <div class="step-content">
              Genera una clave y descarga el archivo JSON
            </div>
          </div>

          <div class="input-group">
            <label for="googleJson">Pega aqu√≠ el contenido del JSON:</label>
            <textarea
              id="googleJson"
              placeholder='{"type": "service_account", "project_id": "..."}'
            ></textarea>
            <button class="btn" onclick="validateGoogleJson()">
              Validar JSON
            </button>
          </div>

          <div class="input-group">
            <label for="spreadsheetId">ID de tu Google Spreadsheet:</label>
            <input
              type="text"
              id="spreadsheetId"
              placeholder="1BxiMVs0XRA5nFMdKvBdBZjgmUUqptlbs74OgvE2upms"
            />
            <button class="btn" onclick="validateSpreadsheetId()">
              Validar ID
            </button>
          </div>

          <div id="googleAlert" class="alert"></div>
        </div>
      </div>

      <!-- Card 3: Generar .env -->
      <div class="card">
        <div class="card-header">
          <div class="card-icon">‚öôÔ∏è</div>
          <div class="card-title">3. Generar Archivo .env</div>
        </div>

        <p style="margin-bottom: 20px">
          Una vez que hayas ingresado todas las credenciales, haz clic para
          generar tu archivo .env
        </p>

        <button
          class="btn btn-success"
          onclick="generateEnvFile()"
          style="font-size: 18px; padding: 15px 40px"
        >
          üöÄ Generar Archivo .env
        </button>

        <div id="outputBox" class="output-box"></div>
        <div id="finalAlert" class="alert"></div>

        <div
          id="instructions"
          style="
            display: none;
            margin-top: 20px;
            padding: 20px;
            background: #fff3cd;
            border-radius: 8px;
            border: 1px solid #ffc107;
          "
        >
          <h3 style="margin-bottom: 15px">üìã √öltimos pasos:</h3>
          <ol style="line-height: 2; margin-left: 20px">
            <li>Copia el contenido del cuadro de arriba</li>
            <li>Abre el archivo <code>.env</code> en tu proyecto</li>
            <li>Pega el contenido</li>
            <li>Guarda el archivo</li>
            <li>Ejecuta: <code>python src/main.py</code></li>
          </ol>
        </div>
      </div>
    </div>

    <script>
      let credentials = {
        telegramToken: "",
        googleJson: "",
        spreadsheetId: "",
      };

      function updateProgress() {
        let completed = 0;
        if (credentials.telegramToken) completed++;
        if (credentials.googleJson) completed++;
        if (credentials.spreadsheetId) completed++;

        const percentage = (completed / 3) * 100;
        document.getElementById("progressFill").style.width = percentage + "%";
        document.getElementById("progressFill").textContent =
          Math.round(percentage) + "%";

        if (completed === 0) {
          document.getElementById("progressText").textContent =
            "Paso 1 de 3: Configurar Bot de Telegram";
        } else if (completed === 1) {
          document.getElementById("progressText").textContent =
            "Paso 2 de 3: Configurar Google Sheets";
        } else if (completed === 2) {
          document.getElementById("progressText").textContent =
            "Paso 3 de 3: ¬°Casi listo!";
        } else {
          document.getElementById("progressText").textContent =
            "‚úÖ ¬°Todo configurado! Genera tu archivo .env";
        }
      }

      function validateTelegramToken() {
        const token = document.getElementById("telegramToken").value.trim();
        const alert = document.getElementById("telegramAlert");

        if (!token) {
          showAlert(alert, "Por favor ingresa un token", "danger");
          return;
        }

        // Validaci√≥n b√°sica del formato del token
        const tokenPattern = /^\d+:[A-Za-z0-9_-]+$/;
        if (!tokenPattern.test(token)) {
          showAlert(
            alert,
            "‚ö†Ô∏è El formato del token parece incorrecto. Debe ser: n√∫meros:letras",
            "danger"
          );
          return;
        }

        credentials.telegramToken = token;
        showAlert(alert, "‚úÖ Token guardado correctamente", "success");
        updateProgress();
      }

      function validateGoogleJson() {
        const jsonText = document.getElementById("googleJson").value.trim();
        const alert = document.getElementById("googleAlert");

        if (!jsonText) {
          showAlert(alert, "Por favor pega el contenido del JSON", "danger");
          return;
        }

        try {
          const json = JSON.parse(jsonText);

          // Validar campos necesarios
          if (
            !json.type ||
            !json.project_id ||
            !json.private_key ||
            !json.client_email
          ) {
            showAlert(
              alert,
              "‚ö†Ô∏è El JSON no tiene todos los campos necesarios",
              "danger"
            );
            return;
          }

          if (json.type !== "service_account") {
            showAlert(
              alert,
              "‚ö†Ô∏è Este no es un JSON de Service Account",
              "danger"
            );
            return;
          }

          credentials.googleJson = btoa(jsonText); // Convertir a Base64
          showAlert(
            alert,
            "‚úÖ JSON validado y codificado en Base64",
            "success"
          );
          updateProgress();
        } catch (e) {
          showAlert(
            alert,
            "‚ùå Error: El JSON no es v√°lido. Verifica que copiaste todo el contenido",
            "danger"
          );
        }
      }

      function validateSpreadsheetId() {
        const id = document.getElementById("spreadsheetId").value.trim();
        const alert = document.getElementById("googleAlert");

        if (!id) {
          showAlert(alert, "Por favor ingresa el ID de la hoja", "danger");
          return;
        }

        // Validaci√≥n b√°sica del formato
        if (id.length < 20) {
          showAlert(
            alert,
            "‚ö†Ô∏è El ID parece muy corto. Verifica que copiaste el ID correcto de la URL",
            "danger"
          );
          return;
        }

        credentials.spreadsheetId = id;
        showAlert(
          alert,
          "‚úÖ ID de Spreadsheet guardado correctamente",
          "success"
        );
        updateProgress();
      }

      function generateEnvFile() {
        const finalAlert = document.getElementById("finalAlert");

        if (!credentials.telegramToken) {
          showAlert(finalAlert, "‚ùå Falta el Token de Telegram", "danger");
          return;
        }

        if (!credentials.googleJson) {
          showAlert(
            finalAlert,
            "‚ö†Ô∏è Advertencia: No se configur√≥ Google Sheets. El bot funcionar√° sin persistencia.",
            "info"
          );
        }

        if (!credentials.spreadsheetId) {
          showAlert(
            finalAlert,
            "‚ö†Ô∏è Advertencia: Falta el ID de la hoja de c√°lculo.",
            "info"
          );
        }

        const envContent = `# Archivo .env generado - ${new Date().toLocaleString()}

# Token de Telegram
TELEGRAM_BOT_TOKEN=${credentials.telegramToken}

# Credenciales de Google Service Account (Base64)
GOOGLE_SERVICE_ACCOUNT_JSON=${credentials.googleJson || "not_configured"}

# ID de Google Spreadsheet
GOOGLE_SPREADSHEET_ID=${credentials.spreadsheetId || "not_configured"}
`;

        const outputBox = document.getElementById("outputBox");
        outputBox.textContent = envContent;
        outputBox.style.display = "block";

        document.getElementById("instructions").style.display = "block";

        showAlert(
          finalAlert,
          "‚úÖ ¬°Archivo .env generado exitosamente! Copia el contenido y p√©galo en tu archivo .env",
          "success"
        );

        // Auto-copiar al portapapeles
        navigator.clipboard.writeText(envContent).then(() => {
          console.log("Contenido copiado al portapapeles");
        });
      }

      function showAlert(element, message, type) {
        element.className = "alert alert-" + type;
        element.textContent = message;
        element.style.display = "block";

        if (type === "success") {
          setTimeout(() => {
            element.style.display = "none";
          }, 5000);
        }
      }

      // Inicializar
      updateProgress();
    </script>
  </body>
</html>
